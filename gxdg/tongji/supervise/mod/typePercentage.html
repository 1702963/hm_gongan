<script>
    //模拟数据
    const eventData = [
      { 
        name: '执法办案', 
        value: 68, 
        itemStyle: { color: '#0A3D91' },
        reasons: [
          { reason: '程序不规范', count: 23, percentage: '33.8%' },
          { reason: '证据不足', count: 18, percentage: '26.5%' },
          { reason: '适用法律错误', count: 12, percentage: '17.6%' }
        ]
      },
      { 
        name: '公务用车', 
        value: 45, 
        itemStyle: { color: '#4A90E2' },
        reasons: [
          { reason: '公车私用', count: 19, percentage: '42.2%' },
          { reason: '未按规定报备', count: 14, percentage: '31.1%' },
          { reason: '超标使用', count: 8, percentage: '17.8%' }
        ]
      },
      { 
        name: '舆情', 
        value: 32, 
        itemStyle: { color: '#E53935' },
        reasons: [
          { reason: '回应不及时', count: 12, percentage: '37.5%' },
          { reason: '处置不当', count: 10, percentage: '31.2%' },
          { reason: '信息发布错误', count: 5, percentage: '15.6%' }
        ]
      },
      { 
        name: '信访', 
        value: 41, 
        itemStyle: { color: '#FF9800' },
        reasons: [
          { reason: '处理超时', count: 15, percentage: '36.6%' },
          { reason: '答复不满意', count: 11, percentage: '26.8%' },
          { reason: '受理不规范', count: 8, percentage: '19.5%' }
        ]
      },
      { 
        name: '现场/网上督察', 
        value: 24, 
        itemStyle: { color: '#9C27B0' },
        reasons: [
          { reason: '纪律松弛', count: 9, percentage: '37.5%' },
          { reason: '工作懈怠', count: 7, percentage: '29.2%' },
          { reason: '违规操作', count: 5, percentage: '20.8%' }
        ]
      }
    ];
var pieChart = echarts.init(document.getElementById('pieP'));
var optionP = {
	title:{
		text:'',
		textStyle:{
			color:'#ffffff'
		},
	},
	tooltip: {
		trigger: 'item',
		formatter: '{a} <br/>{b}: {c} ({d}%)'
	},
	legend: {
		orient: 'vertical',
		right: 60,           
		top: 'center', 
		padding:[30,0,30,0],
		textStyle: {
			fontSize: 12,
			color: '#ffffff'
		},
		itemWidth: 12,
		itemHeight: 12,
		itemGap:20
	},
	series: [
		{
			name: '年度监督事件类型占比',
			type: 'pie',
			radius: ['50%', '70%'],  // 环形图内外半径
			center: ['30%', '55%'],  // 图表中心位置（左移以给右侧标签留出空间）
			avoidLabelOverlap: false,
			itemStyle: {
				borderRadius: 8,
			},
			// 扇区上显示百分比
			label: {
				show: true,
				position: 'outside',  // 显示在扇区内部
				formatter: '{b}\n{c}件({d}%)',   // 显示百分比
				fontSize: 12,
				fontWeight: '500',
				color:'#ffffff'
			},
			// 隐藏标签连接线（因为文字在扇区内）
			labelLine: {
				show: true,
				length: 15,
				length2: 10,
				lineStyle: {
					width: 1
				}
			},
			emphasis: {
				label: {
					show: true,
					fontSize: 16,
					fontWeight: 'bold'
				}
			},
			data: [
				{ value: 15, name: '执法办案' },
				{ value: 40, name: '公务用车' },
				{ value: 25, name: '舆情' },
				{ value: 12, name: '信访' },
				{ value: 8, name: '现场/网上督察' }
			]
		}
	],
	graphic:{
		type:'text',
		left:125,
		top:140,
		style:{
			text:'年度总事件数\n1000',
			textAlign:'center',
			fill:'#ffffff',
			fontSize:16
		}
	},
	color: [
		'#8884d8',  // 未知 - 紫色
		'#52c41a',  // 健康 - 绿色
		'#faad14',  // 亚健康 - 黄色
		'#f5222d',  // 疾病 - 红色
		'#1890ff'   // 其他 - 蓝色
	]
};
pieChart.setOption(optionP);
pieChart.on('click', function(params) {
	console.log('click pie:',eventData[params.dataIndex]);
	console.log('toSelectData:',eventData[params.dataIndex].name)
	
	var winName = eventData[params.dataIndex].name;
	var winData = eventData[params.dataIndex].reasons;
	var elementHtml = "";
	console.log('toSelectData:',winData);

	winData.forEach(function(element, index, arr) {
		console.log(element.reason, element.count, index);
		var myName = element.reason;
		var myCount = element.count;
		var myIndex = index + 1;
		elementHtml = elementHtml + "<div class=\"winConList\">"+"<div class=\"winConListNum\">"+myIndex+"</div>"+"<div class=\"winConListName\">"+myName+"</div>"+"<div class=\"winConListcode\">"+myCount+"</div></div>"
	});
	console.log('for Html:',elementHtml);
	
	//<div class="winConList">
	//	<div class="winConListNum">1</div>
	//	<div class="winConListName">纪律松弛</div>
	//	<div class="winConListcode">9</div>
	//</div>

	
	document.getElementById('winContentTitle').innerHTML = winName;
	document.getElementById('winContent').innerHTML = elementHtml;
	$("#pieWindow").fadeIn();
	$(".winTitle em").click(function(){
		$("#pieWindow").fadeOut();
	})
});
</script>